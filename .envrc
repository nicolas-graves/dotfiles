#!/usr/bin/env sh

export GUILE_LOAD_PATH=./

SSH_LIST="$(rbw list | grep '^ssh_')"
for ssh in $SSH_LIST ; do
    content="$(rbw get --full $ssh 2>/dev/null)"
    export "ID_$ssh"=$(echo "$content" | rg 'Username' | cut -d' ' -f2-)
    export "KEY_$ssh"=$(echo "$content" | head -1 | grep -v 'Username')
    export "URI_$ssh"=$(echo "$content" | rg 'URI' | cut -d' ' -f2-)
    export "PORT_$ssh"=$(echo "$content" | rg 'Port' | cut -d' ' -f2-)
    export "HOSTKEY_$ssh"="$(echo "$content" | rg 'HostKey' | cut -d' ' -f2-)"
done ;

SERVICE_LIST="$(rbw list | grep '^service_')"
for service in $SERVICE_LIST ; do
    content="$(rbw get --full $service 2>/dev/null)"
    export "URI_$service"=$(echo "$content" | rg 'URI' | cut -d' ' -f2-)
    port=$(echo "$content" | rg 'Port' | cut -d' ' -f2-)
    [ -z "${port}" ] || export "PORT_$service"="$port"
    user=$(echo "$content" | rg 'Username' | cut -d' ' -f2-)
    [ -z "${user}" ] || export "USER_$service"="$user"
done ;
